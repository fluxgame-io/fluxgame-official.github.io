<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FLUXGAME | Hills Climber</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; touch-action: none; }
        body { background-color: #050505; color: white; font-family: 'Segoe UI', sans-serif; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }
        
        /* Navbar */
        nav { width: 100%; padding: 15px 5%; display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.9); border-bottom: 2px solid #00f2ff; z-index: 100; }
        .logo { font-size: 1.2rem; font-weight: bold; color: #00f2ff; text-shadow: 0 0 10px #00f2ff; }
        .score { font-size: 1rem; color: #9214ff; font-weight: bold; }

        /* Game Area */
        #gameCanvas {
            flex-grow: 1;
            width: 100%;
            background: linear-gradient(180deg, #111 0%, #000 100%);
        }

        /* Controls Hint */
        .controls-hint {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            padding: 10px 20px;
            border-radius: 20px;
            border: 1px solid #333;
            color: #888;
            font-size: 0.8rem;
            pointer-events: none;
        }
    </style>
</head>
<body>

    <nav>
        <div class="logo">FLUXGAME | Hills Climber</div>
        <div class="score">Score: <span id="scoreVal">0</span></div>
    </nav>

    <canvas id="gameCanvas"></canvas>

    <div class="controls-hint">Hold to Accelerate</div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreVal = document.getElementById('scoreVal');

        // Resize Canvas
        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = canvas.clientHeight; // Game area only
        }
        window.addEventListener('resize', resize);
        resize();

        // Game State
        let gameActive = true;
        let score = 0;
        let terrainPoints = [];
        let screenOffset = 0;
        let inputActive = false;

        // Car object
        const car = {
            x: 100,
            y: 0,
            r: 15, // Radius (for collision/drawing)
            vY: 0, // Velocity Y
            vX: 0, // Velocity X
            w: 40,
            h: 20,
            angle: 0
        };

        const GRAVITY = 0.5;
        const ACCELERATION = 0.3;
        const DRAG = 0.99;

        // Handle Input
        window.addEventListener('mousedown', () => inputActive = true);
        window.addEventListener('mouseup', () => inputActive = false);
        window.addEventListener('touchstart', (e) => { e.preventDefault(); inputActive = true; }, { passive: false });
        window.addEventListener('touchend', () => inputActive = false);
        window.addEventListener('keydown', (e) => { if (e.code === 'Space' || e.code === 'ArrowRight') inputActive = true; });
        window.addEventListener('keyup', (e) => { if (e.code === 'Space' || e.code === 'ArrowRight') inputActive = false; });

        // Generate initial terrain
        function initTerrain() {
            terrainPoints = [];
            let y = canvas.height * 0.7;
            for (let x = 0; x < canvas.width * 2; x++) {
                y += (Math.random() - 0.5) * 8; // Adjust randomness for hill height
                terrainPoints.push({ x: x, y: y });
            }
        }
        initTerrain();

        function restartGame() {
            car.x = 100;
            car.y = canvas.height * 0.5;
            car.vY = 0;
            car.vX = 0;
            car.angle = 0;
            score = 0;
            screenOffset = 0;
            initTerrain();
            gameActive = true;
            scoreVal.innerText = score;
        }
        restartGame();

        function update() {
            if (!gameActive) return;

            // Physics
            car.vY += GRAVITY;

            // Input handling
            if (inputActive) {
                car.vX += ACCELERATION;
            } else {
                car.vX *= DRAG; // Smooth deceleration
            }

            // Move car
            car.x += car.vX;
            car.y += car.vY;

            // Simple camera follow
            if (car.x > canvas.width * 0.4) {
                let diff = car.x - canvas.width * 0.4;
                screenOffset += diff;
                car.x = canvas.width * 0.4;
                
                // Regenerate terrain (simple approach)
                while(terrainPoints[0].x < screenOffset - 100) {
                    let lastP = terrainPoints[terrainPoints.length - 1];
                    let nextY = lastP.y + (Math.random() - 0.5) * 8;
                    terrainPoints.push({x: lastP.x + 1, y: nextY});
                    terrainPoints.shift();
                }
            }

            // Terrain Collision
            // Find current x index in visible terrainPoints
            let terrainIndex = 0;
            for(let i=0; i<terrainPoints.length; i++){
                if(terrainPoints[i].x >= screenOffset + car.x){
                    terrainIndex = i;
                    break;
                }
            }

            if(terrainIndex > 0){
                let p1 = terrainPoints[terrainIndex-1];
                let p2 = terrainPoints[terrainIndex];

                // Simple interpolation for car height on slope
                let ratio = (screenOffset + car.x - p1.x) / (p2.x - p1.x);
                let terrainY = p1.y + (p2.y - p1.y) * ratio;

                // Simple collision: keep car above terrain
                if (car.y > terrainY - car.h/2) {
                    car.y = terrainY - car.h/2;
                    
                    // Simple friction/rotation on slope (placeholder)
                    car.vY = 0;
                    car.angle = Math.atan2(p2.y - p1.y, p2.x - p1.x);

                    // Game over check (too much speed/wrong angle, placeholder)
                    if(car.angle > Math.PI/3 || car.angle < -Math.PI/3){
                        // gameActive = false; // Simple placeholder for now
                    }
                }
            }

            // Score
            score = Math.floor(screenOffset / 100);
            scoreVal.innerText = score;

            // Screen bounds
            if (car.y > canvas.height) {
                gameActive = false; // Game Over (fell off)
            }
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw Terrain
            ctx.beginPath();
            ctx.moveTo(0, canvas.height);
            for (let i = 0; i < terrainPoints.length; i++) {
                ctx.lineTo(terrainPoints[i].x - screenOffset, terrainPoints[i].y);
            }
            ctx.lineTo(canvas.width, canvas.height);
            ctx.closePath();
            ctx.fillStyle = '#00f2ff33'; // Semi-transparent blue
            ctx.fill();
            ctx.strokeStyle = '#00f2ff';
            ctx.lineWidth = 2;
            ctx.stroke();

            // Draw Car
            ctx.save();
            ctx.translate(car.x, car.y);
            ctx.rotate(car.angle);
            ctx.fillStyle = '#9214ff'; // Car color
            ctx.fillRect(-car.w/2, -car.h/2, car.w, car.h);
            ctx.strokeStyle = 'white';
            ctx.strokeRect(-car.w/2, -car.h/2, car.w, car.h);
            
            // Wheels
            ctx.fillStyle = '#333';
            ctx.beginPath(); ctx.arc(-15, 10, 8, 0, Math.PI*2); ctx.fill();
            ctx.beginPath(); ctx.arc(15, 10, 8, 0, Math.PI*2); ctx.fill();
            ctx.restore();

            // Draw GameOver
            if (!gameActive) {
                ctx.fillStyle = 'rgba(0,0,0,0.8)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = 'white';
                ctx.font = '3rem sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('GAME OVER!', canvas.width/2, canvas.height/2);
                ctx.font = '1.2rem sans-serif';
                ctx.fillStyle = '#aaa';
                ctx.fillText('Final Score: ' + score, canvas.width/2, canvas.height/2 + 40);
                ctx.fillText('Tap or Press Space to Restart', canvas.width/2, canvas.height/2 + 80);
            }
        }

        // Main Loop
        function loop() {
            update();
            draw();
            requestAnimationFrame(loop);
        }

        // Handle GameOver restart
        window.addEventListener('click', () => { if (!gameActive) restartGame(); });
        window.addEventListener('touchend', () => { if (!gameActive) restartGame(); });
        window.addEventListener('keydown', (e) => { if (!gameActive && (e.code === 'Space' || e.code === 'Enter')) restartGame(); });

        loop();

    </script>
</body>
</html>
