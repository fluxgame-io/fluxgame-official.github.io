<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KABIR: BRIGHT LIGHTS</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Courier New', monospace; touch-action: none; }
        #crosshair { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #fff; font-size: 24px; pointer-events: none; z-index: 100; }
        .hud { position: fixed; top: 10px; left: 10px; color: #00f2ff; background: rgba(0,0,0,0.7); padding: 12px; z-index: 100; font-size: 13px; pointer-events: none; border-left: 4px solid #00f2ff; }
        #msg { position: fixed; top: 20%; width: 100%; text-align: center; color: #00f2ff; display: none; z-index: 1000; font-weight: bold; background: rgba(0,0,0,0.8); padding: 15px; border: 1px solid #00f2ff; }
    </style>
</head>
<body>

    <div id="crosshair">+</div>
    <div id="msg"></div>
    
    <div id="hud" class="hud">
        <b>KABIR SENSOR SYSTEM</b><br>
        ROOM 1: <span id="r1-stat" style="color:yellow">ON</span> | ROOM 2: <span id="r2-stat" style="color:yellow">ON</span><br>
        [H] Switch/Door | [F] Torch
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script>
        let scene, camera, renderer, torch, door;
        let yaw = new THREE.Object3D(), pitch = new THREE.Object3D();
        let moveF = 0, moveR = 0, isSprinting = false;
        let colliders = [], interactables = [];
        let room1Light, room2Light;

        init();

        function init() {
            scene = new THREE.Scene();
            // Fog kam kar di taaki door tak saaf dikhe
            scene.fog = new THREE.FogExp2(0x000000, 0.03); 
            
            camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
            yaw.add(pitch); pitch.add(camera); scene.add(yaw);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            document.body.appendChild(renderer.domElement);

            // 1. FLOOR & CEILING
            const floorMat = new THREE.MeshStandardMaterial({ color: 0x444444 });
            const floor = new THREE.Mesh(new THREE.PlaneGeometry(60, 60), floorMat);
            floor.rotation.x = -Math.PI/2; floor.position.y = -2; floor.receiveShadow = true;
            scene.add(floor);

            // 2. MAIN ROOM LIGHTS (Intensity badha kar 2.5 kar di hai)
            room1Light = new THREE.PointLight(0xffffff, 2.5, 25);
            room1Light.position.set(0, 4, -7);
            room1Light.castShadow = true;
            scene.add(room1Light);

            room2Light = new THREE.PointLight(0xffffff, 2.5, 30);
            room2Light.position.set(0, 4, 10);
            room2Light.castShadow = true;
            scene.add(room2Light);

            // Visual bulbs on ceiling
            const bulbGeo = new THREE.SphereGeometry(0.2, 16, 16);
            const bulbMat = new THREE.MeshBasicMaterial({color: 0xffffff});
            const bulb1 = new THREE.Mesh(bulbGeo, bulbMat); bulb1.position.set(0, 4, -7); scene.add(bulb1);
            const bulb2 = new THREE.Mesh(bulbGeo, bulbMat); bulb2.position.set(0, 4, 10); scene.add(bulb2);

            // 3. WALLS (Thoda light color taaki roshni reflect ho)
            const wallMat = new THREE.MeshStandardMaterial({ color: 0x888888 }); 
            createWall(0, 1.5, -15, 20, 7, wallMat); // Back
            createWall(-10, 1.5, 0, 30, 7, wallMat, true); // Left
            createWall(10, 1.5, 0, 30, 7, wallMat, true); // Right
            createWall(-6, 1.5, 0, 8, 7, wallMat); // Mid Left
            createWall(6, 1.5, 0, 8, 7, wallMat); // Mid Right

            // 4. DOOR
            door = new THREE.Mesh(new THREE.BoxGeometry(4, 5.5, 0.3), new THREE.MeshStandardMaterial({color: 0x5d4037}));
            door.position.set(0, 0.75, 0); door.userData = { type: 'door', isOpen: false };
            scene.add(door); colliders.push(door); interactables.push(door);

            // 5. SWITCHES (Red color taaki andhere mein bhi dikhe)
            createSwitch(-2, 1, -0.2, 1); // Switch for Room 1
            createSwitch(2, 1, 0.2, 2);  // Switch for Room 2

            // 6. FURNITURE
            createFurniture(0, -1, -8, 4, 0.2, 2.5, 0x4a2c16); // R1 Table
            createFurniture(6, -0.5, 10, 4, 2, 2, 0x222222); // R2 Sofa

            // 7. TORCH
            torch = new THREE.SpotLight(0xffffff, 40);
            torch.angle = Math.PI/7; camera.add(torch); 
            torch.target.position.set(0, 0, -1); camera.add(torch.target);

            setupControls();
            animate();
        }

        function createWall(x, y, z, w, h, mat, rotate=false) {
            const wall = new THREE.Mesh(new THREE.PlaneGeometry(w, h), mat);
            wall.position.set(x, y, z);
            if(rotate) wall.rotation.y = Math.PI/2;
            scene.add(wall);
            const box = new THREE.Mesh(new THREE.BoxGeometry(rotate?0.5:w, h, rotate?w:0.5));
            box.position.set(x, y, z); box.visible = false;
            scene.add(box); colliders.push(box);
        }

        function createSwitch(x, y, z, roomNum) {
            const sw = new THREE.Mesh(new THREE.BoxGeometry(0.3, 0.4, 0.1), new THREE.MeshStandardMaterial({color: 0xff0000}));
            sw.position.set(x, y, z); sw.userData = { type: 'switch', room: roomNum };
            scene.add(sw); interactables.push(sw);
        }

        function createFurniture(x, y, z, w, h, d, col) {
            const obj = new THREE.Mesh(new THREE.BoxGeometry(w, h, d), new THREE.MeshStandardMaterial({ color: col }));
            obj.position.set(x, y, z); obj.castShadow = true; obj.receiveShadow = true;
            scene.add(obj); colliders.push(obj);
        }

        function setupControls() {
            document.addEventListener('keydown', (e) => {
                const key = e.key.toLowerCase();
                if(key === 'w') moveF = 1; if(key === 's') moveF = -1;
                if(key === 'a') moveR = -1; if(key === 'd') moveR = 1;
                if(e.code === 'Space') isSprinting = true;
                if(key === 'f') torch.visible = !torch.visible;
                if(key === 'h') interact();
            });
            document.addEventListener('keyup', (e) => {
                const key = e.key.toLowerCase();
                if(['w','s'].includes(key)) moveF = 0; if(['a','d'].includes(key)) moveR = 0;
                if(e.code === 'Space') isSprinting = false;
            });
            document.addEventListener('pointermove', (e) => {
                if(document.pointerLockElement) {
                    yaw.rotation.y -= e.movementX * 0.002;
                    pitch.rotation.x -= e.movementY * 0.002;
                    pitch.rotation.x = Math.max(-1.5, Math.min(1.5, pitch.rotation.x));
                }
            });
            document.addEventListener('mousedown', () => document.body.requestPointerLock());
        }

        function interact() {
            interactables.forEach(obj => {
                if(yaw.position.distanceTo(obj.position) < 4) {
                    if(obj.userData.type === 'door') {
                        obj.userData.isOpen = !obj.userData.isOpen;
                        obj.position.x = obj.userData.isOpen ? 4 : 0;
                        if(obj.userData.isOpen) colliders = colliders.filter(c => c !== door);
                        else colliders.push(door);
                        showMessage(obj.userData.isOpen ? "DOOR OPENED" : "DOOR CLOSED");
                    }
                    if(obj.userData.type === 'switch') {
                        if(obj.userData.room === 1) {
                            room1Light.visible = !room1Light.visible;
                            document.getElementById('r1-stat').innerText = room1Light.visible ? "ON" : "OFF";
                        } else {
                            room2Light.visible = !room2Light.visible;
                            document.getElementById('r2-stat').innerText = room2Light.visible ? "ON" : "OFF";
                        }
                        showMessage("ROOM " + obj.userData.room + " LIGHT TOGGLED");
                    }
                }
            });
        }

        function showMessage(t) {
            const m = document.getElementById('msg');
            m.innerText = t; m.style.display = 'block';
            setTimeout(() => m.style.display = 'none', 1500);
        }

        function animate() {
            requestAnimationFrame(animate);
            let speed = isSprinting ? 0.20 : 0.08;
            if(moveF || moveR) {
                const dir = new THREE.Vector3(moveR, 0, -moveF).normalize().applyQuaternion(yaw.quaternion);
                const nextPos = yaw.position.clone().addScaledVector(dir, speed);
                let canMove = true;
                const pBox = new THREE.Box3().setFromCenterAndSize(nextPos, new THREE.Vector3(0.8, 4, 0.8));
                for(let obj of colliders) { if(pBox.intersectsBox(new THREE.Box3().setFromObject(obj))) { canMove = false; break; } }
                if(canMove) yaw.position.copy(nextPos);
            }
            renderer.render(scene, camera);
        }
    </script>
</body>
</html>
