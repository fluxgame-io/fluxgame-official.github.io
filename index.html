<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DETECTIVE KABIR: FINAL STABLE</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Courier New', monospace; }
        #crosshair { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #fff; font-size: 20px; pointer-events: none; z-index: 100; }
        .hud { position: fixed; bottom: 20px; left: 20px; color: #00f2ff; background: rgba(0,0,0,0.8); padding: 15px; border: 1px solid #00f2ff; z-index: 100; pointer-events: none; }
        #msg { position: fixed; top: 40%; width: 100%; text-align: center; color: yellow; font-size: 20px; display: none; z-index: 1000; }
    </style>
</head>
<body>

    <div id="crosshair">+</div>
    <div id="msg">DOOR LOCKED</div>
    
    <div class="hud">
        <b>KABIR INVESTIGATION</b><br>
        1. Screen par Click karo<br>
        2. WASD se chalo (Shift = Run)<br>
        3. H se Pot uthao / Door kholo
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script>
        let scene, camera, renderer, torch, flowerPot, door;
        let yaw = new THREE.Object3D(), pitch = new THREE.Object3D();
        let moveState = { f: 0, r: 0, sprint: 1 };
        let colliders = [], interactables = [], roomLights = [];
        let hasCode = false, isExamining = false;

        init();

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0a0a0a);
            camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
            
            yaw.add(pitch); pitch.add(camera); scene.add(yaw);
            yaw.position.y = 0; // Ground height par set

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            document.body.appendChild(renderer.domElement);

            // LIGHTS (Bahut Bright)
            const light1 = new THREE.PointLight(0xffffff, 2, 30);
            light1.position.set(0, 4, -7); scene.add(light1);
            roomLights.push(light1);

            const light2 = new THREE.PointLight(0xffffff, 2, 30);
            light2.position.set(0, 4, 10); scene.add(light2);
            roomLights.push(light2);

            // FLOOR
            const floor = new THREE.Mesh(new THREE.PlaneGeometry(100, 100), new THREE.MeshStandardMaterial({ color: 0x222222 }));
            floor.rotation.x = -Math.PI/2; floor.position.y = -2; floor.receiveShadow = true;
            scene.add(floor);

            // WALLS (Box ki jagah Plane use kiye hain takki collision smooth ho)
            createWall(0, 1, -15, 20, 7); // Back
            createWall(-10, 1, 0, 30, 7, true); // Left
            createWall(10, 1, 0, 30, 7, true); // Right
            
            // DOOR
            door = new THREE.Mesh(new THREE.BoxGeometry(4, 6, 0.3), new THREE.MeshStandardMaterial({color: 0x4a2c16}));
            door.position.set(0, 1, 0); scene.add(door);
            colliders.push(door); interactables.push(door);

            // TABLE & POT
            const table = new THREE.Mesh(new THREE.BoxGeometry(4, 1, 2.5), new THREE.MeshStandardMaterial({color: 0x3d2b1f}));
            table.position.set(0, -1.5, -8); scene.add(
